<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />


<meta name="author" content="Roman Neubauer" />

<meta name="date" content="2020-11-05" />

<title>Journal</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/bootstrap.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>
<link href="site_libs/anchor-sections-1.0/anchor-sections.css" rel="stylesheet" />
<script src="site_libs/anchor-sections-1.0/anchor-sections.js"></script>

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />



<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 51px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h2 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h3 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h4 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h5 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h6 {
  padding-top: 56px;
  margin-top: -56px;
}
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #ffffff;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  background: white;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}

@media print {
.toc-content {
  /* see https://github.com/w3c/csswg-drafts/issues/4434 */
  float: right;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row-fluid">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">MyLabJournal</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">Home</a>
</li>
<li>
  <a href="journal.html">Journal</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Class notes
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="dictionary.html">Dictionary</a>
    </li>
    <li>
      <a href="data_wrangling.html">Data Wrangling</a>
    </li>
    <li>
      <a href="ggplot_graphs.html">ggplot graphs</a>
    </li>
    <li>
      <a href="machine_learning.html">machine learning</a>
    </li>
  </ul>
</li>
<li>
  <a href="links.html">Links</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">



<h1 class="title toc-ignore">Journal</h1>
<h4 class="author">Roman Neubauer</h4>
<h4 class="date">2020-11-05</h4>

</div>


<p><strong>IMPORTANT:</strong> Uploaded on 06.12.2020</p>
<div id="introduction-to-the-tidyverse" class="section level1">
<h1><span class="header-section-number">1</span> Introduction to the tidyverse</h1>
<div id="challenges" class="section level2">
<h2><span class="header-section-number">1.1</span> Challenges</h2>
<div id="analysis-of-bikes-sales-by-states-and-cities-in-germany" class="section level3">
<h3><span class="header-section-number">1.1.1</span> Analysis of bikes sales by states and cities in Germany</h3>
<p>Problem: Analysis of sales by location: display the total revenue of all bikes shops across a state or city in a bar plot.</p>
<ol style="list-style-type: decimal">
<li>Load needed libraries</li>
</ol>
<pre class="r"><code>library(&quot;tidyverse&quot;)
library(&quot;readxl&quot;)
library(&quot;lubridate&quot;)</code></pre>
<ol start="2" style="list-style-type: decimal">
<li>Importing the data from .xlsx files</li>
</ol>
<pre class="r"><code>bikes &lt;- read_excel(&quot;00_data/01_bike_sales/01_raw_data/bikes.xlsx&quot;) %&gt;% set_names(names(.) %&gt;% str_replace_all(&quot;\\.&quot;, &quot;_&quot;)) %&gt;% select(bike_id, model, price)
shops &lt;- read_excel(&quot;00_data/01_bike_sales/01_raw_data/bikeshops.xlsx&quot;) %&gt;% set_names(names(.) %&gt;% str_replace_all(&quot;\\.&quot;, &quot;_&quot;))
orders &lt;- read_excel(&quot;00_data/01_bike_sales/01_raw_data/orderlines.xlsx&quot;) %&gt;% select(- ...1) %&gt;% set_names(names(.) %&gt;% str_replace_all(&quot;\\.&quot;, &quot;_&quot;))</code></pre>
<p>in the same step some unneeded columns were dropped and all dots in column names were replaced by underscores.</p>
<ol start="3" style="list-style-type: decimal">
<li>Joining the data sets and wrangling</li>
</ol>
<pre class="r"><code>orders_shops_joined &lt;- left_join(orders, shops, by=c(&quot;customer_id&quot; = &quot;bikeshop_id&quot;)) %&gt;% select(-lat, -lng, -order_line)

joined_data &lt;- left_join(orders_shops_joined, bikes, by=c(&quot;product_id&quot;=&quot;bike_id&quot;)) %&gt;% 
  #separating city and state
  separate(col=location, into=c(&quot;city&quot;, &quot;state&quot;), sep=&quot;, &quot;) %&gt;% 
  #calculating total order price
  mutate(total_price = price*quantity) %&gt;% 
  #adding year of the sale
  mutate(year = year(order_date))</code></pre>
<ol start="4" style="list-style-type: decimal">
<li>Manipulating</li>
</ol>
<p>getting the sales per state:</p>
<pre class="r"><code>sales_by_state &lt;- joined_data %&gt;% 
  #select needed columns
  select(state, total_price) %&gt;% 
  #grouping by state
  group_by(state) %&gt;% 
  #adding all revenues for the given states
  summarize(revenue = sum(total_price)) %&gt;% 
  #formatting the revenue 
  mutate(revenue_text = scales::dollar(revenue, big.mark = &quot;.&quot;, decimal.mark = &quot;,&quot;, prefix = &quot;&quot;, suffix = &quot; €&quot;))</code></pre>
<p>getting the sales by city</p>
<pre class="r"><code>sales_by_city &lt;- joined_data %&gt;% 
  #select needed columns
  select(city, total_price) %&gt;% 
  #grouping by city
  group_by(city) %&gt;% 
  #adding all revenues for the given city
  summarize(revenue = sum(total_price)) %&gt;% 
  #formatting the revenue
  mutate(revenue_text = scales::dollar(revenue, big.mark = &quot;.&quot;, decimal.mark = &quot;,&quot;, prefix = &quot;&quot;, suffix = &quot; €&quot;))</code></pre>
<ol start="5" style="list-style-type: decimal">
<li>Plotting the data</li>
</ol>
<p>for the sales by state:</p>
<pre class="r"><code>sales_by_state %&gt;%
  
  # Setup canvas with the columns states (x-axis) and revenue (y-axis)
  ggplot(aes(x = state, y = revenue)) +
  
  # Geometries
  geom_col(fill = &quot;#2DC6D6&quot;) +
  geom_label(aes(label = revenue_text), size=2) +
  
  # Formatting
  scale_y_continuous(labels = scales::dollar_format(big.mark = &quot;.&quot;, 
                                                    decimal.mark = &quot;,&quot;, 
                                                    prefix = &quot;&quot;, 
                                                    suffix = &quot; €&quot;)) +
  
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
  
  labs(
    title    = &quot;Revenue by state over 5 years&quot;,
    x = &quot;State&quot;,
    y = &quot;Revenue&quot;
  )</code></pre>
<p><img src="journal_files/figure-html/unnamed-chunk-6-1.png" width="672" /></p>
<p>for the sales by city:</p>
<pre class="r"><code>sales_by_city %&gt;%
  
  # Setup canvas with the columns states (x-axis) and revenue (y-axis)
  ggplot(aes(x = city, y = revenue)) +
  
  # Geometries
  geom_col(fill = &quot;#2DC6D6&quot;) +
  geom_label(aes(label = revenue_text), size=2) +
  
  # Formatting
  scale_y_continuous(labels = scales::dollar_format(big.mark = &quot;.&quot;, 
                                                    decimal.mark = &quot;,&quot;, 
                                                    prefix = &quot;&quot;, 
                                                    suffix = &quot; €&quot;)) +
  
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
  
  labs(
    title    = &quot;Revenue by city over 5 years&quot;,
    x = &quot;City&quot;,
    y = &quot;Revenue&quot;
  )</code></pre>
<p><img src="journal_files/figure-html/unnamed-chunk-7-1.png" width="672" /></p>
</div>
<div id="analysis-of-bike-sales-by-state-and-year" class="section level3">
<h3><span class="header-section-number">1.1.2</span> Analysis of bike sales by state and year</h3>
<p>Steps 1 to 3 remain the same as in 1.1.1.</p>
<ol start="4" style="list-style-type: decimal">
<li>Manipulating getting the sales by state and year:</li>
</ol>
<pre class="r"><code>sales_by_state_and_year &lt;- joined_data %&gt;% 
  #select needed columns
  select(state, year, total_price) %&gt;% 
  #grouping by state and year
  group_by(state, year) %&gt;% 
  #adding all revenues for a given state and year
  summarize(revenue = sum(total_price)) %&gt;% 
  #formatting the revenue
  mutate(revenue_text = scales::dollar(revenue, big.mark = &quot;.&quot;, decimal.mark = &quot;,&quot;, prefix = &quot;&quot;, suffix = &quot; €&quot;))</code></pre>
<ol start="5" style="list-style-type: decimal">
<li>Plotting</li>
</ol>
<pre class="r"><code>sales_by_state_and_year %&gt;%
  
  # Set up x, y, fill
  ggplot(aes(x = year, y = revenue, fill = state)) +
  
  # Geometries
  geom_col() +
  
  # Facet
  facet_wrap(~ state) +
  
  # Formatting
  scale_y_continuous(labels = scales::dollar_format(big.mark = &quot;.&quot;, 
                                                    decimal.mark = &quot;,&quot;, 
                                                    prefix = &quot;&quot;, 
                                                    suffix = &quot; €&quot;)) +
  
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
  
  labs(
    title = &quot;Revenue by state and year&quot;,
    subtitle = &quot;displayed revenue for all  bikeshops in a given state&quot;,
    fill = &quot;States&quot;
  )</code></pre>
<p><img src="journal_files/figure-html/plot-1.png" width="1152" /></p>
</div>
</div>
</div>
<div id="data-acquisition" class="section level1">
<h1><span class="header-section-number">2</span> Data Acquisition</h1>
<div id="challenges-1" class="section level2">
<h2><span class="header-section-number">2.1</span> Challenges</h2>
<div id="getting-data-via-an-api-marketstack" class="section level3">
<h3><span class="header-section-number">2.1.1</span> Getting data via an API: marketstack</h3>
<p>Problem: Acquiring data from an API for a data scientific purpose.</p>
<p>In the following code financial data will be requested from marketstack.com, which provide an API. For the sake of this example, the adjusted daily closing price of Amazon stock will be requested for the time period of one year. A free access to marketstack’s API is granted after signing up and getting an API key, which will be used to authenticate all requests.</p>
<ol style="list-style-type: decimal">
<li>Load needed libraries</li>
</ol>
<pre class="r"><code>library(readr)
library(httr)
library(glue)
library(jsonlite)
library(tidyverse)
library(ggplot2)
library(lubridate)</code></pre>
<ol start="2" style="list-style-type: decimal">
<li>Build the request url / query string</li>
</ol>
<pre class="r"><code>API_KEY &lt;- read_file(&quot;00_data/apikey.txt&quot;)
symbol = &quot;AMZN&quot;    # ticker for the Amazon stock
limit = &quot;300&quot;      # number of days, approx. 300 trading days a year
url = glue(&#39;http://api.marketstack.com/v1/eod?access_key={API_KEY}&amp;symbols={symbol}&amp;limit=300&#39;)</code></pre>
<ol start="3" style="list-style-type: decimal">
<li>Getting the data</li>
</ol>
<pre class="r"><code>amzn &lt;- GET(url) %&gt;% .$content %&gt;% rawToChar() %&gt;% fromJSON() %&gt;% .$data %&gt;% as_tibble() #%&gt;% select(adj_close, date)
head(amzn)</code></pre>
<pre><code>## # A tibble: 6 x 13
##    open  high   low close volume adj_high adj_low adj_close adj_open adj_volume
##   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;    &lt;dbl&gt;   &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;      &lt;dbl&gt;
## 1 3198. 3198. 3159. 3163. 2.91e6    3198.   3159.     3163.    3198.    2913611
## 2 3205. 3229. 3181. 3187. 2.89e6    3229.   3181.     3187.    3205.    2892039
## 3 3222. 3232  3173. 3204. 3.13e6    3232    3173.     3204.    3222.    3129304
## 4 3188. 3249. 3157. 3220. 4.49e6    3249.   3157.     3220.    3188.    4493554
## 5 3208. 3228. 3126. 3168. 4.06e6    3228.   3126.     3168.    3208.    4063916
## 6 3211. 3216. 3190. 3195. 2.39e6    3216.   3190.     3195.    3211.    2392867
## # … with 3 more variables: symbol &lt;chr&gt;, exchange &lt;chr&gt;, date &lt;chr&gt;</code></pre>
<ol start="4" style="list-style-type: decimal">
<li>Visualization Plotting the adjusted close over the last year.</li>
</ol>
<pre class="r"><code>amzn$date &lt;- as.Date(amzn$date, format=&quot;%Y-%m-%dT00:00:00+0000&quot;)
ggplot(data=amzn, aes(x=date, y= adj_close)) + 
  geom_line(color=&quot;#2DC6D6&quot;) + 
  labs(x = &quot;Date&quot;, 
       y = &quot;Adjusted closing Price&quot;,
       title = &quot;Amazon stock price&quot;)</code></pre>
<p><img src="journal_files/figure-html/unnamed-chunk-12-1.png" width="672" /></p>
</div>
<div id="webscraping" class="section level3">
<h3><span class="header-section-number">2.1.2</span> Webscraping</h3>
<p>Problem: Acquiring data from rosebikes.de via web scraping to build a Database about their products.</p>
<ol style="list-style-type: decimal">
<li>Load needed libraries</li>
</ol>
<pre class="r"><code>library(tidyverse)
library(rvest)</code></pre>
<ol start="2" style="list-style-type: decimal">
<li>Collect product families</li>
</ol>
<pre class="r"><code>url &lt;- &quot;https://www.rosebikes.de/&quot;

# getting raw html from homepage
html_home &lt;- read_html(url)

# scraping the ids for each bike family

bike_family &lt;- html_home %&gt;%
  # get nodes for families
  html_nodes(css=&quot;.main-navigation-category-with-tiles__title&quot;) %&gt;% 
  # getting text in between span tags
  html_text() %&gt;% 
  # in a tibble
  as_tibble()

# removing rows (bikes,sales)
bike_family &lt;- bike_family[c(-1,-12),]

#scraping the subdirectories in the same way
bike_family_url &lt;- html_home %&gt;% 
  html_nodes(css=&quot;.main-navigation-category-with-tiles__link &quot;) %&gt;% 
  html_attr(&#39;href&#39;) %&gt;% 
  as_tibble() %&gt;%
  # adding in a second row urls of bike families
  mutate(url=glue(&quot;https://www.rosebikes.de{value}&quot;))

bike_family_url &lt;- bike_family_url[-11,]

#joining the tibbles
bike_family$url &lt;- bike_family_url$url

print(bike_family)</code></pre>
<pre><code>## # A tibble: 10 x 2
##    value            url                                          
##    &lt;chr&gt;            &lt;glue&gt;                                       
##  1 &quot;\nMTB\n&quot;        https://www.rosebikes.de/fahrräder/mtb       
##  2 &quot;\nRennrad\n&quot;    https://www.rosebikes.de/fahrräder/rennrad   
##  3 &quot;\nGravel\n&quot;     https://www.rosebikes.de/fahrräder/gravel    
##  4 &quot;\nCyclocross\n&quot; https://www.rosebikes.de/fahrräder/cyclocross
##  5 &quot;\nFitness\n&quot;    https://www.rosebikes.de/fahrräder/fitness   
##  6 &quot;\nE-Bike\n&quot;     https://www.rosebikes.de/fahrräder/e-bike    
##  7 &quot;\nTrekking\n&quot;   https://www.rosebikes.de/fahrräder/trekking  
##  8 &quot;\nReise\n&quot;      https://www.rosebikes.de/fahrräder/reise     
##  9 &quot;\nUrban\n&quot;      https://www.rosebikes.de/fahrräder/urban     
## 10 &quot;\nKinder\n&quot;     https://www.rosebikes.de/fahrräder/kinder</code></pre>
<ol start="3" style="list-style-type: decimal">
<li>Collect bike data Now that the bike families and respecting links are gathered in a tibble, it is possible to scrape the data of each product in a bike family. Retrieving all product categories.</li>
</ol>
<pre class="r"><code>url_road_bikes &lt;- bike_family$url[2] %&gt;% as.character()

road_bikes_html &lt;- read_html(url_road_bikes)

bike_categories_url &lt;- road_bikes_html %&gt;%
  html_nodes(css=&quot;.catalog-category-bikes__button&quot;) %&gt;%
  html_attr(&quot;href&quot;) %&gt;%
  enframe(name=&quot;position&quot;, value=&quot;sub_url&quot;) %&gt;%
  mutate(url=glue(&quot;https://www.rosebikes.de{sub_url}&quot;)) %&gt;%
  select(-sub_url)
  
bike_categories &lt;- road_bikes_html %&gt;%
  html_nodes(css=&quot;.catalog-category-bikes__title-text&quot;) %&gt;%
  html_text() %&gt;% 
  enframe(name=&quot;position&quot;, value=&quot;category&quot;) %&gt;%
  left_join(bike_categories_url)</code></pre>
<p>Defining a function that will retrieve the data for each bike category</p>
<pre class="r"><code>get_bike_data &lt;- function(url) {
  
  html_body &lt;- read_html(url)
  
  model_names &lt;- html_body %&gt;%
    html_nodes(css=&quot;.catalog-category-model__title&quot;) %&gt;%
    html_text() %&gt;%
    enframe(name=&quot;position&quot;, value=&quot;model_name&quot;)
  
  model_infos &lt;- html_body %&gt;% 
    html_nodes(css=&quot;.catalog-category-model-info__list&quot;) %&gt;%
    html_text() %&gt;%
    enframe(name=&quot;position&quot;, value=&quot;infos&quot;) %&gt;%
    separate(infos, c(&quot;weight&quot;, &quot;wheel&quot;, &quot;equipment&quot;), &quot;\n\n\n&quot;)

  model_prices &lt;- html_body %&gt;% 
    html_nodes(css=&quot;.product-tile-price__current-value.catalog-category-model__price-current-value&quot;) %&gt;%
    html_text() %&gt;%
    enframe(name=&quot;position&quot;, value=&quot;price&quot;)

  model_tbl &lt;- left_join(model_names, model_infos) %&gt;% left_join(model_prices)
  return(model_tbl)
}

# The data from all bikes is gathered using a for loop and executing the function for all scraped bike category urls.
bike_data = get_bike_data(bike_categories$url[1])

for (i in 2:length(bike_categories$url)) {
  bike_data &lt;- rbind(bike_data, get_bike_data(bike_categories$url[i]))
}

head(bike_data)</code></pre>
<pre><code>## # A tibble: 6 x 6
##   position model_name      weight    wheel               equipment       price  
##      &lt;int&gt; &lt;chr&gt;           &lt;chr&gt;     &lt;chr&gt;               &lt;chr&gt;           &lt;chr&gt;  
## 1        1 &quot;\nPRO SL DISC… &quot;\nGewic… Laufrad: DT Swiss … &quot;Ausstattung: … &quot;\n1.5…
## 2        2 &quot;\nPRO SL DISC… &quot;\nGewic… Laufrad: DT Swiss … &quot;Ausstattung: … &quot;\n1.8…
## 3        1 &quot;\nPRO SL 105\… &quot;\nGewic… Laufrad: DT Swiss … &quot;Ausstattung: … &quot;\n1.1…
## 4        2 &quot;\nPRO SL Ulte… &quot;\nGewic… Laufrad: DT Swiss … &quot;Ausstattung: … &quot;\n1.4…
## 5        1 &quot;\nREVEAL FOUR… &quot;\nGewic… Laufrad: ROSE - La… &quot;Ausstattung: … &quot;\n2.4…
## 6        2 &quot;\nREVEAL FOUR… &quot;\nGewic… Laufrad: ROSE - La… &quot;Ausstattung: … &quot;\n2.7…</code></pre>
<p>In the tibble bike_data, the data for all bikes in the family ‘Rennrad’ are displayed with additional information like price, weight and equipment.</p>
</div>
</div>
</div>
<div id="data-wrangling" class="section level1">
<h1><span class="header-section-number">3</span> Data Wrangling</h1>
<div id="challenges-2" class="section level2">
<h2><span class="header-section-number">3.1</span> Challenges</h2>
<div id="challenge-1-patent-dominance" class="section level3">
<h3><span class="header-section-number">3.1.1</span> Challenge 1 :Patent dominance</h3>
<p>Problem: Which of US companies/corporations have the most number of listed patents? Top 10.</p>
<ol style="list-style-type: decimal">
<li>Loading needed libraries (for all 3 challenges)</li>
</ol>
<pre class="r"><code>library(tidyverse)
library(vroom)
library(data.table)</code></pre>
<ol start="2" style="list-style-type: decimal">
<li>Load the patent data from patentsview.org load the following tables:</li>
</ol>
<ul>
<li>assignee table</li>
<li>patent_assignee table</li>
</ul>
<pre class="r"><code># load assignee table as data.table

col_assignee &lt;- list(
  id = col_character(),
  type = col_character(),
  name_first = col_character(),
  name_last = col_character(),
  organization = col_character()
)

assignee_tbl &lt;- vroom(
            file       = &quot;00_data/assignee.tsv&quot;, 
            delim      = &quot;\t&quot;, 
            col_types  = col_assignee,
            na         = c(&quot;&quot;, &quot;NA&quot;, &quot;NULL&quot;)
        )

setDT(assignee_tbl)

# load patent_assignee table as data.table

col_pa &lt;- list(
  patent_id = col_character(),
  assignee_id = col_character(),
  loaction_id = col_character()
)


pa_tbl &lt;- vroom(
            file       = &quot;00_data/patent_assignee.tsv&quot;, 
            delim      = &quot;\t&quot;, 
            col_types  = col_pa,
            na         = c(&quot;&quot;, &quot;NA&quot;, &quot;NULL&quot;)
        )

setDT(pa_tbl)</code></pre>
<ol start="3" style="list-style-type: decimal">
<li>Merging data</li>
</ol>
<pre class="r"><code>combined_data &lt;- merge(x = assignee_tbl, y = pa_tbl, 
                       by.x    = &quot;id&quot;, 
                       by.y    = &quot;assignee_id&quot;)

combined_data %&gt;% glimpse()</code></pre>
<pre><code>## Rows: 6,789,243
## Columns: 7
## $ id           &lt;chr&gt; &quot;org_000ey6U69efJ6KrjwQW8&quot;, &quot;org_000ey6U69efJ6KrjwQW8&quot;, …
## $ type         &lt;chr&gt; &quot;3&quot;, &quot;3&quot;, &quot;3&quot;, &quot;3&quot;, &quot;3&quot;, &quot;3&quot;, &quot;3&quot;, &quot;3&quot;, &quot;3&quot;, &quot;3&quot;, &quot;3&quot;, &quot;…
## $ name_first   &lt;chr&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …
## $ name_last    &lt;chr&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …
## $ organization &lt;chr&gt; &quot;Lhoist Recherche et Developpement S.A.&quot;, &quot;Lhoist Recher…
## $ patent_id    &lt;chr&gt; &quot;5173279&quot;, &quot;5277837&quot;, &quot;5290353&quot;, &quot;5591247&quot;, &quot;10008685&quot;, …
## $ location_id  &lt;chr&gt; &quot;6324fbf2-ac0f-4403-a100-bd54683189c3&quot;, &quot;6324fbf2-ac0f-4…</code></pre>
<ol start="4" style="list-style-type: decimal">
<li>Wrangling The following code selects all US companies (where type = 2) and sorts in ascending order the number of patents.</li>
</ol>
<pre class="r"><code>us_patent_companies &lt;-  combined_data[type==2,.N, by=organization][order(N, decreasing=TRUE)]
head(us_patent_companies,10) #prints out top 10 companies and number of patents</code></pre>
<pre><code>##                                    organization      N
##  1: International Business Machines Corporation 139091
##  2:                    General Electric Company  47121
##  3:                           Intel Corporation  42156
##  4:   Hewlett-Packard Development Company, L.P.  35572
##  5:                       Microsoft Corporation  30085
##  6:                     Micron Technology, Inc.  28000
##  7:                       QUALCOMM Incorporated  24702
##  8:              Texas Instruments Incorporated  24181
##  9:                           Xerox Corporation  23173
## 10:                                  Apple Inc.  21820</code></pre>
</div>
<div id="challenge-2-recent-patent-activity" class="section level3">
<h3><span class="header-section-number">3.1.2</span> Challenge 2: Recent patent activity</h3>
<p>Problem: Which US companies listed the most patents in 2019? Top 10.</p>
<ol style="list-style-type: decimal">
<li>Load needed libraries same as in Challenge 1 and lubridate</li>
</ol>
<pre class="r"><code>library(lubridate)</code></pre>
<ol start="2" style="list-style-type: decimal">
<li>Load the patent data from patentsview.org load the following tables:</li>
</ol>
<ul>
<li>assignee table (done in Challenge 1)</li>
<li>patent_assignee table (done in Challenge 1)</li>
<li>patent table</li>
</ul>
<pre class="r"><code># load patent table as data.table
# skip all the columns but id and date since the criteria is 2019

col_patent &lt;- list(
  id = col_character(),
  type = col_skip(),
  number = col_skip(),
  country = col_skip(),
  date = col_date(&quot;%Y-%m-%d&quot;),
  abstract = col_skip(),
  title = col_skip(),
  kind = col_skip(),
  num_claims = col_skip(),
  filename = col_skip(),
  withdrawn = col_skip()
)

patent_tbl &lt;- vroom(
            file       = &quot;00_data/patent.tsv&quot;, 
            delim      = &quot;\t&quot;, 
            col_types  = col_patent,
            na         = c(&quot;&quot;, &quot;NA&quot;, &quot;NULL&quot;)
        )

setDT(patent_tbl)</code></pre>
<ol start="3" style="list-style-type: decimal">
<li>Merging data</li>
</ol>
<pre class="r"><code>combined_data2 &lt;- merge(x = combined_data, y = patent_tbl, 
                       by.x    = &quot;patent_id&quot;, 
                       by.y    = &quot;id&quot;)

combined_data2 %&gt;% glimpse()</code></pre>
<pre><code>## Rows: 6,789,243
## Columns: 8
## $ patent_id    &lt;chr&gt; &quot;10000000&quot;, &quot;10000001&quot;, &quot;10000002&quot;, &quot;10000003&quot;, &quot;1000000…
## $ id           &lt;chr&gt; &quot;org_nVO9qbgVusOCsqolUzwW&quot;, &quot;org_XsQO6RGuhBmfEX0Bd1cR&quot;, …
## $ type         &lt;chr&gt; &quot;2&quot;, &quot;3&quot;, &quot;3&quot;, &quot;3&quot;, &quot;3&quot;, &quot;3&quot;, &quot;3&quot;, &quot;2&quot;, &quot;2&quot;, &quot;2&quot;, &quot;2&quot;, &quot;…
## $ name_first   &lt;chr&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …
## $ name_last    &lt;chr&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …
## $ organization &lt;chr&gt; &quot;Raytheon Company&quot;, &quot;LS MTRON LTD.&quot;, &quot;KOLON INDUSTRIES, …
## $ location_id  &lt;chr&gt; &quot;277153ee-6c5b-425a-84f5-6148e4b0cb08&quot;, &quot;7f4f050d-83b7-4…
## $ date         &lt;date&gt; 2018-06-19, 2018-06-19, 2018-06-19, 2018-06-19, 2018-06…</code></pre>
<ol start="4" style="list-style-type: decimal">
<li>Wrangling</li>
</ol>
<pre class="r"><code>#create new &quot;year&quot; column
combined_data2[, year := year(date) ]

#select all data where year = 2019 and other condition from challenge 1
us19_patents &lt;- combined_data2[type==2 &amp; year==2019,.N,by=organization][order(N, decreasing=TRUE)]

# print top 10 companies with most patents in 2019
head(us19_patents,10)</code></pre>
<pre><code>##                                    organization    N
##  1: International Business Machines Corporation 9265
##  2:                           Intel Corporation 3526
##  3:         Microsoft Technology Licensing, LLC 3106
##  4:                                  Apple Inc. 2817
##  5:               Ford Global Technologies, LLC 2624
##  6:                   Amazon Technologies, Inc. 2533
##  7:                       QUALCOMM Incorporated 2359
##  8:                                 Google Inc. 2290
##  9:                    General Electric Company 1860
## 10:   Hewlett-Packard Development Company, L.P. 1589</code></pre>
</div>
<div id="challenge-3-innovation-in-tech" class="section level3">
<h3><span class="header-section-number">3.1.3</span> Challenge 3: Innovation in Tech</h3>
<p>Problem: What is the most innovative (most patents) Tech sector worldwide? for the top 10 companies &amp; What are the top 5 uscp main classes ?</p>
<ol style="list-style-type: decimal">
<li><p>Load needed libraries same as in Challenge 1 &amp; 2</p></li>
<li><p>Load the patent data from patentsview.org load the following tables:</p></li>
</ol>
<ul>
<li>assignee table (done in Challenge 1)</li>
<li>patent_assignee table (done in Challenge 1)</li>
<li>uspc table</li>
<li>mainclass_current</li>
</ul>
<pre class="r"><code># load uspc table as data.table
# skip all the columns but id and date since the criteria is 2019

col_uspc &lt;- list(
  uuid = col_character(),
  patent_id = col_character(),
  mainclass_id = col_character(),
  subclass_id = col_character(),
  sequence = col_integer()
)

uspc_tbl &lt;- vroom(
            file       = &quot;00_data/uspc.tsv&quot;, 
            delim      = &quot;\t&quot;, 
            col_types  = col_uspc,
            na         = c(&quot;&quot;, &quot;NA&quot;, &quot;NULL&quot;)
        )

setDT(uspc_tbl)


#load mainclass_current table

col_mainclass &lt;- list(
  id = col_character(),
  title = col_character())

mainclass_tbl &lt;- vroom(
            file       = &quot;00_data/mainclass_current.tsv&quot;, 
            delim      = &quot;\t&quot;, 
            col_types  = col_mainclass,
            na         = c(&quot;&quot;, &quot;NA&quot;, &quot;NULL&quot;)
        )

setDT(mainclass_tbl)</code></pre>
<ol start="3" style="list-style-type: decimal">
<li>Merging data</li>
</ol>
<pre class="r"><code>combined_data3 &lt;- merge(x = combined_data, y = uspc_tbl, 
                       by    = &quot;patent_id&quot;)

combined_data3 &lt;- merge(x = combined_data3, y = mainclass_tbl, 
                       by.x    = &quot;mainclass_id&quot;,
                       by.y    = &quot;id&quot;)

combined_data3 %&gt;% glimpse()</code></pre>
<pre><code>## Rows: 16,382,795
## Columns: 12
## $ mainclass_id &lt;chr&gt; &quot;-0T&quot;, &quot;01L&quot;, &quot;01L&quot;, &quot;01L&quot;, &quot;01L&quot;, &quot;01L&quot;, &quot;01L&quot;, &quot;01L&quot;, …
## $ patent_id    &lt;chr&gt; &quot;PP7315&quot;, &quot;3935040&quot;, &quot;3944447&quot;, &quot;3966512&quot;, &quot;3968460&quot;, &quot;4…
## $ id           &lt;chr&gt; &quot;org_xiGdOQJrkYfHcTC5rHbX&quot;, &quot;org_pLL87qnubNLz2M3dMLci&quot;, …
## $ type         &lt;chr&gt; &quot;2&quot;, &quot;2&quot;, &quot;2&quot;, &quot;3&quot;, &quot;2&quot;, &quot;2&quot;, &quot;3&quot;, &quot;2&quot;, &quot;6&quot;, &quot;3&quot;, &quot;2&quot;, &quot;…
## $ name_first   &lt;chr&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …
## $ name_last    &lt;chr&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …
## $ organization &lt;chr&gt; &quot;Yoder Brothers, Inc.&quot;, &quot;Harris Corporation&quot;, &quot;IBM Corpo…
## $ location_id  &lt;chr&gt; &quot;586e647e-678a-4acb-992f-27279e1c86e9&quot;, &quot;0107d8bd-dffb-4…
## $ uuid         &lt;chr&gt; &quot;9u64q2vk7becnxo3n7qf3b6kv&quot;, &quot;kna0vnw7es9yixzy7wqvz4v1p&quot;…
## $ subclass_id  &lt;chr&gt; &quot;-0T/74&quot;, &quot;01L/311.2&quot;, &quot;01L/271.2&quot;, &quot;01L/271.4&quot;, &quot;01L/41…
## $ sequence     &lt;int&gt; 0, 9, 15, 11, 3, 6, 2, 6, 5, 6, 8, 4, 5, 2, 12, 11, 10, …
## $ title        &lt;chr&gt; &quot;DOES NOT EXIST&quot;, &quot;DOES NOT EXIST&quot;, &quot;DOES NOT EXIST&quot;, &quot;D…</code></pre>
<ol start="4" style="list-style-type: decimal">
<li>Wrangling</li>
</ol>
<pre class="r"><code># order all main classes after the number of patents (all time)
tech_sectors &lt;- combined_data3[,.N,by=title][order(N,decreasing=TRUE)]
tech_sectors %&gt;% head(10)</code></pre>
<pre><code>##                                                                   title      N
##  1:               ORGANIC COMPOUNDS -- PART OF THE CLASS 532-570 SERIES 724246
##  2: SYNTHETIC RESINS OR NATURAL RUBBERS -- PART OF THE CLASS 520 SERIES 628395
##  3:                  DRUG, BIO-AFFECTING AND BODY TREATING COMPOSITIONS 602110
##  4:  ACTIVE SOLID-STATE DEVICES (E.G., TRANSISTORS, SOLID-STATE DIODES) 444181
##  5:                                                      DOES NOT EXIST 431044
##  6:                            STOCK MATERIAL OR MISCELLANEOUS ARTICLES 412856
##  7:                       CHEMISTRY: MOLECULAR BIOLOGY AND MICROBIOLOGY 374457
##  8:                         SEMICONDUCTOR DEVICE MANUFACTURING: PROCESS 286881
##  9:                                                             SURGERY 286688
## 10:                                                  TELECOMMUNICATIONS 263938</code></pre>
<pre class="r"><code>#selecting top 10 worldwide organizations with most patents
world_companies &lt;- combined_data3[!is.na(organization),.N,by=organization][order(N, decreasing=TRUE)][1:10,organization]

#selecting all patent data from the companies selected above by mainclass_id and order after number of patents
main_classes &lt;- combined_data3[organization %in% world_companies][!(title==&quot;DOES NOT EXIST&quot;),.N,by=title][order(N, decreasing=TRUE)]
main_classes %&gt;% head(5) #shows the top 5 technology sectors with highest number of patents</code></pre>
<pre><code>##                                                                 title     N
## 1: ACTIVE SOLID-STATE DEVICES (E.G., TRANSISTORS, SOLID-STATE DIODES) 93854
## 2:                        SEMICONDUCTOR DEVICE MANUFACTURING: PROCESS 53872
## 3:                           STATIC INFORMATION STORAGE AND RETRIEVAL 41338
## 4:                                                 TELECOMMUNICATIONS 36627
## 5:                                           MULTIPLEX COMMUNICATIONS 36588</code></pre>
<p>Summary:</p>
<ul>
<li><p>Most patents belong to the category: Organic Compounds</p></li>
<li><p>Most patents from the top 10 most innovative companies belong to the category: Active Solid-State Devices</p></li>
</ul>
</div>
</div>
</div>
<div id="data-visualization" class="section level1">
<h1><span class="header-section-number">4</span> Data Visualization</h1>
<div id="challenges-3" class="section level2">
<h2><span class="header-section-number">4.1</span> Challenges</h2>
<p>Load covid-19 data:</p>
<pre class="r"><code>library(tidyverse)
covid_data_tbl &lt;- read_csv(&quot;https://opendata.ecdc.europa.eu/covid19/casedistribution/csv&quot;)</code></pre>
<div id="challenge-1-covid-19-cases" class="section level3">
<h3><span class="header-section-number">4.1.1</span> Challenge 1: Covid-19 cases</h3>
<p>Problem: Plot the cumulative covid-19 cases.</p>
<ol style="list-style-type: decimal">
<li>Load needed libraries</li>
</ol>
<pre class="r"><code>library(lubridate)
library(ggplot2)
library(ggrepel)</code></pre>
<ol start="2" style="list-style-type: decimal">
<li>Data Manipulation</li>
</ol>
<pre class="r"><code>#covid_data_tbl$countriesAndTerritories %&gt;% unique()

countries &lt;- c(&quot;Germany&quot;, &quot;United_Kingdom&quot;, &quot;France&quot;, &quot;Spain&quot;, &quot;United_States_of_America&quot;)

cum_covid_cases &lt;- covid_data_tbl %&gt;% 
  
  #select and filter needed columns and countries
  select(cases, dateRep, countriesAndTerritories) %&gt;%
  filter(countriesAndTerritories %in% countries) %&gt;%
  
  #to date 
  mutate(date=dmy(dateRep)) %&gt;% 
  select(-dateRep) %&gt;%
  
  #one column for each country
  pivot_wider(names_from=countriesAndTerritories, values_from=cases) %&gt;%
  arrange(date) %&gt;%
  
  #cumulative sums
  mutate(csGermany=cumsum(Germany), csFrance=cumsum(France), csUS=cumsum(United_States_of_America), csSpain=cumsum(Spain), csUK=cumsum(United_Kingdom)) %&gt;%
  
  #for the major countries in Europe
  mutate(csEurope=csGermany+csFrance+csSpain+csUK)
  

cum_covid_cases %&gt;% tail(15)</code></pre>
<pre><code>## # A tibble: 15 x 12
##    date       France Germany Spain United_Kingdom United_States_o… csGermany
##    &lt;date&gt;      &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt;          &lt;dbl&gt;            &lt;dbl&gt;     &lt;dbl&gt;
##  1 2020-11-22  17881   15741     0          19875           175494    918269
##  2 2020-11-23  13157   10864 25886          18662           157471    929133
##  3 2020-11-24   4452   13554 12228          15450           173963    942687
##  4 2020-11-25   9155   18633 10222          11299           170293    961320
##  5 2020-11-26  16282   22268 12289          18213           186589    983588
##  6 2020-11-27  13563   22806 10853          17555           106091   1006394
##  7 2020-11-28  12539   21695     0          14739           207913   1028089
##  8 2020-11-29  12500   14611     0          15871           154893   1042700
##  9 2020-11-30   9784   11169 19979          12155           136670   1053869
## 10 2020-12-01   4005   13604  8257          12330           157903   1067473
## 11 2020-12-02   8083   17270  9331          13429           180421   1084743
## 12 2020-12-03  14064   22046 10127          16170           203311   1106789
## 13 2020-12-04  12696   23448  8745          14878           214747   1130237
## 14 2020-12-05  11221   23318     0          16298           231930   1153555
## 15 2020-12-06  12923   17767    NA          15539           211933   1171322
## # … with 5 more variables: csFrance &lt;dbl&gt;, csUS &lt;dbl&gt;, csSpain &lt;dbl&gt;,
## #   csUK &lt;dbl&gt;, csEurope &lt;dbl&gt;</code></pre>
<ol start="3" style="list-style-type: decimal">
<li>Visualization</li>
</ol>
<pre class="r"><code># Data Visualization
cum_covid_cases %&gt;%
    
    # Canvas
    ggplot(aes(date)) +
    
    # Geometries
  
    geom_line(aes(y=csGermany, color = &quot;Germany&quot;)) +
    
    geom_line(aes(y=csFrance, color = &quot;France&quot;)) +
    
    geom_line(aes(y=csSpain, color = &quot;Spain&quot;)) +
  
    geom_line(aes(y=csUK, color = &quot;UK&quot;)) +
  
    geom_line(aes(y=csUS, color = &quot;US&quot;)) +
  
    geom_line(aes(y=csEurope, color = &quot;maj. EU&quot;)) +
    
    geom_label(data = cum_covid_cases %&gt;% filter(csUS == max(csUS)), aes(label = max(csUS), x=today()-10, y=max(csUS)), size=2) + 
    #adding &#39;, color=&quot;US&quot;&#39; to aes() as argument makes the colored line in the legend to an &quot;a&quot;
    
    # Formatting
    labs(
      title = &quot;Covid-19 confirmed cases worldwide&quot;,
      subtitle = &quot;as of January 1st&quot;,
      x = &quot;Year 2020&quot;,
      y = &quot;Cumulative Cases&quot;,
      color = &quot;Country/Continent&quot;
    ) +
  
    scale_color_brewer(type=&quot;qual&quot;, palette = 2) +
  
    scale_y_continuous(labels = scales::dollar_format(scale = 1e-6,
                                                      decimal.mark = &quot;,&quot;,
                                                      prefix = &quot;&quot;,
                                                      suffix = &quot; M&quot;)) +
    scale_x_date(date_breaks = &quot;1 month&quot;, date_labels =  &quot;%B&quot;) +
    
    theme_light() +
    theme(
        axis.text.x=element_text(angle=50, hjust=1),
        legend.position = &quot;bottom&quot;,
        plot.title = element_text(face = &quot;bold&quot;)
    )</code></pre>
<p><img src="journal_files/figure-html/unnamed-chunk-31-1.png" width="672" /></p>
</div>
<div id="challenge-2-mortality-rate" class="section level3">
<h3><span class="header-section-number">4.1.2</span> Challenge 2: Mortality rate</h3>
<p>Problem: Plot the cumulative covid-19 cases.</p>
<ol style="list-style-type: decimal">
<li>Load needed libraries</li>
</ol>
<pre class="r"><code>library(ggplot2)
library(maps)
library(lubridate)
library(RColorBrewer)</code></pre>
<ol start="2" style="list-style-type: decimal">
<li>Data Manipulation</li>
</ol>
<pre class="r"><code>world &lt;- map_data(&quot;world&quot;)


covid_mapping_data &lt;- covid_data_tbl %&gt;%
  
  #selection
  select(countriesAndTerritories, popData2019, deaths) %&gt;%
  
  # change country names
  mutate(across(countriesAndTerritories, str_replace_all, &quot;_&quot;, &quot; &quot;)) %&gt;%
  mutate(countriesAndTerritories = case_when(
    countriesAndTerritories == &quot;United Kingdom&quot; ~ &quot;UK&quot;,
    countriesAndTerritories == &quot;United States of America&quot; ~ &quot;USA&quot;,
    countriesAndTerritories == &quot;Czechia&quot; ~ &quot;Czech Republic&quot;,
    TRUE ~ countriesAndTerritories
  )) %&gt;%

  #group and summarize
  group_by(countriesAndTerritories) %&gt;%
  summarize(total_deaths=sum(deaths), total_population=unique(popData2019)) %&gt;%
  ungroup() %&gt;%
  
  #calculate mortality rate in %
  mutate(mrate= 100*total_deaths/total_population) %&gt;%
  
  #join world table
  left_join(world, by=c(&quot;countriesAndTerritories&quot;=&quot;region&quot;))</code></pre>
<ol start="3" style="list-style-type: decimal">
<li>Visualization</li>
</ol>
<pre class="r"><code>covid_mapping_data %&gt;% 
  
  ggplot(aes(x=long, y=lat)) +
  
  geom_map(aes(map_id=countriesAndTerritories, fill=mrate), map=world) +
  
  #Formatting
  labs(
      title = &quot;Covid-19 mortality rate by country&quot;,
      subtitle = &quot;deaths since January 1st&quot;,
      x = &quot;longitude&quot;,
      y = &quot;latitude&quot;
    ) +
  
    scale_fill_gradientn(&quot;Mortality Rate in %&quot;,colours=brewer.pal(1,&quot;YlOrRd&quot;)) +

    theme_light() +
    theme(
        plot.title = element_text(face = &quot;bold&quot;)
    )</code></pre>
<p><img src="journal_files/figure-html/unnamed-chunk-34-1.png" width="672" /></p>
</div>
</div>
</div>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open')
  });
});
</script>

<!-- code folding -->

<script>
$(document).ready(function ()  {

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_');
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
